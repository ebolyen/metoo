Requirements
============

0. Glossary
-----------

artifact: Any referenceable piece of data that has been either imported into, or
    generated by, an analysis.

nj: neighbor-joining, or New Jersey (context dependent)

MSA: Multiple Sequence Alignment

PFMSA: Positionally Filtered MSA

PTree: Phylogenetic Tree

User: A standard qiime user

Workflow: A template describing a series of methods/workflows (as a DAGs) with it's own input, output, and unique namespace.

Method: A atomic unit of computation taking input and producing output.

1. Stories
----------
* __1.1.1__ Interface Stories
    * __1.1.0__ All interfaces
    * __1.1.1__ CLI
        * __#.#.#.#__ User creates a new analysis by typing `qiime create {analysis-name}`.
          The newly created analysis is activated for the user.
        * __#.#.#.#__ User activates an existing analysis by typing `qiime activate {analysis-name}`.
          User's command prompt changes to indicate the currently active analysis name.
        * __#.#.#.#__ User deactivates the current analysis by typing `qiime deactivate {analysis-name}`.
          User's command prompt changes to indicate that an analysis is not active.
        * __#.#.#.#__ User deactivates current analysis context and deletes an
          existing analysis by typing `qiime delete {analysis-name}`.
        * __#.#.#.#__ User imports raw sequence data with `qiime load {url} {artifact name}`.
          Progress bar indicates status, and when import is complete, the artifact name is printed.
          If artifact name is not provided, the basename of the URL is used.
        * __#.#.#.#__ User imports raw sequence data with `qiime load {local filepath} {artifact name}`.
          Progress bar indicates status, and when import is complete, the artifact name is printed.
          If artifact name is not provided, the basename of the file is used.
        * __#.#.#.#__ User deletes an artifact with `qiime delete {artifact name}`.
        * __#.#.#.#__ User renames an artifact with `qiime rename {current artifact name} {new artifact name}`.
        * __#.#.#.#__ User views the history and metadata of an artifact by typing `qiime review {artifact name}`.
        * __#.#.#.#__ User exports an artifact with `qiime download {artifact name} {file format} {local filepath}`.
          Progress bar indicates export/download status.
        * __#.#.#.#__ User views artifacts in a tree layout by typing `qiime list artifacts {options}`.
        * __#.#.#.#__ User views methods by typing `qiime list methods {options}`.
        * __#.#.#.#__ User views workflows by typing `qiime list workflows {options}`.
        * __#.#.#.#__ User runs a method by typing `qiime run {method name} {options}`. A job ID is printed.
        * __#.#.#.#__ User runs a workflow by typing `qiime run {workflow name} {namespace} {options}`.
          If a namespace is not provided, the workflow name is used as the namespace. A job ID is printed.
        * __#.#.#.#__ User downloads a custom workflow from a collaborator and runs it
          by typing `qiime run {workflow filepath} {namespace} {options}`. A job ID is printed.
        * __1.1.1.1__ User types `qiime help`, `qiime -h`, or `qiime --help` and
          a concise and readable document regarding usage is printed to the
          screen.
        * __1.1.1.3__ User has a job id, they type `qiime status {ID}` and the state
          of {ID} is printed.
        * __1.1.1.4__ User types `qiime status` or `qiime status {tab}{tab}` to
          see all running workflows.
        * __1.1.1.5__ User types `qiime config` to see the state of their
          installation
        * __1.1.1.6__ User types `qiime config set {property}={value}` to modify
          a line of their configuration without opening an editor.
        * __1.1.1.7__ User types `qiime help {method}`, `qiime {method} help`,
          `qiime {method} -h`, or `qiime {method} --help` to learn more about
          {method}.
    * __1.1.2__ GUI
        * __#.#.#.#__ User starts a QIIME2 server by typing
          `qiime-server start {options}`. QIIME2 server starts locally and opens
          a web browser for the user.
        * __#.#.#.#__ User logs in to QIIME2 server via a web browser. The server
          can be running locally or remotely.
        * __#.#.#.#__ New user is prompted to take an optional quick tour
          and work through an example analysis.
        * __#.#.#.#__ New user creates their analysis by clicking the "New Analysis" button.
        * __#.#.#.#__ Existing user sees a list of their analyses in a list view,
          with summary information indicating status.
        * __#.#.#.#__ User deletes an analysis from the analyses list view by
          clicking "Delete Analysis". They are prompted to confirm deletion by
          typing the name of the analysis.
        * __#.#.#.#__ User selects an analysis to interact with by clicking on
          its name in the analysis list view.
        * __#.#.#.#__ 
* __1.2__ Process Stories
    * __1.2.1__ Sample Metadata Validation
        * __1.2.1.1__ User provides sample metadata and is provided a useful
          report on the validity. ()
    * __1.2.2__ Sequence Filtering
        * __1.2.2.1__ In a sequencing platform agnostic way: User provides raw
          sequence and quality information and can validate, quality filter,
          and demultiplex the data for use later. ()
            * __1.2.2.1.1__ User can quality filter and demultiplex independently
              or together. ([3.1](#3.1))
    * __1.2.3__ OTU picking
        * __1.2.3.1__ User provides demultiplexed sequences and preforms de novo
          OTU picking resulting in an OTU table, map, and representative
          sequences
        * __1.2.3.2__ User provides demultiplexed sequences and reference sequences
          (may be arbitrary) and preforms closed reference OTU picking resulting
          in an OTU table, map, and representative sequences
        * __1.2.3.3__ User provides demultiplexed sequences and reference sequences
          (may be arbitrary) and preforms open reference OTU picking resulting
          in an OTU table, map, and representative sequences
    * __1.2.4__ Taxonomy Assignment
        * __1.2.4.1__ User provides sequence (any kind) and reference sequences with
          associated taxonomic assignments, then preforms taxonomic assignment
          resulting in observation metadata.
    * __1.2.5__ Multiple Sequence Alignment
        * __1.2.5.1__ User provides sequences (any kind) and preforms de novo MSA
          resulting in an MSA.
        * __1.2.5.2__ User provides sequences (any kind) and reference alignment and
          preforms reference-based multiple sequence alignment (e.g. PyNast)
          resulting in an MSA.
    * __1.2.6__ Multiple Sequence Alignment Filtering
        * __1.2.6.1__ User provides an MSA and a `lane-mask`, then preforms `static`
          filtering resulting in a PFMSA.
        * __1.2.6.2__ User provides a multiple sequence alignment and preforms
          dynamic filtering resulting in a PFMSA.
    * __1.2.7__ Phylogenetic Reconstruction
        * __1.2.7.1__ User provides an MSA and preforms phylogentic reconstruction
          resulting in a PTree.
        * __1.2.7.2__ User provides an MSA, reference MSA, and reference PTree,
          adding new sequences to the existing reference PTree resulting in the
          augmented reference PTree.
    * __1.2.8__
* __1.3__ Sysadmin Stories
    * Sysadmin installs QIIME2 and is pleasantly surprised at how easy and configurable it is.
    * Sysadmin specifies ports for communication to interfaces.
    * Sysadmin specifies cluster settings for parallel computation.
    * Sysadmin specifies database to use with QIIME2.
    * Sysadmin specifies port for QIIME2 server to listen on.
* __1.4__ Publication Stories
    * __#.#.#__ Serializing Data
        * __#.#.#.#__ User exports an object from their analysis in a given file format.
    * __#.#.#__ Publishing Data
        * __#.#.#.#__ User generates a report of the features they need to
          share with their collaborators. It is downloaded as a plain html file
          which they email to their collaborators.
        * __#.#.#.#__ A user generates a report of features and raw output files
          which they need to share. They download it as a zipfile and email it
          to their collaborators.
            * __#.#.#.#.#__ A collaborator opens a zipfile of a report and clicks
              on a link in the index that describes a file included alongside the
              report.
        * __#.#.#.#__ A user downloads their ENTIRE analysis including raw input
          files to share with a journal for reproducibility.


2. Functional Requirements
--------------------------


* __#.#__ Representation

* __#.#__ Analysis Management
    * __#.#.#__ Every job created by a user exists in the context of an analysis.
    * __#.#.#__ An analysis should be understood in a relational way (sample centric).
    * __#.#.#__ At minimum, an analysis has a name, creation-date, and author.
    * __#.#.#__ An analysis may include metadata as user defined key-value pairs.
    * __#.#.#__ All input and resulting output is encaplsulated by the analysis and is referenced by a unique id string.
    * __#.#.#__
* __2.1__ Semantic Type System
* Users must provide the number of parallel processes that are submitted local or to a cluster for parallel work.
* A config file will specify the default number of parallel processes that will be used when a number is not otherwise supplied.


3. Non-functional Requirements
------------------------------
* __#.#__ Compatibilty
    * __#.#.#__ All interface clients will work on Windows, OS X, and
      Linux variants.
* __#.#__ Reproducibility
    * __#.#.#__ All anaylsis should be easily reproduced in full by
      downloading a file and importing it into a compatible qiime engine.
* __3.1__ Read file in a single pass when possible.<a name=`3.1`>
* __#.#__ Security
    * __#.#.#__ Web interface avoids CSRF.


Questions for Chris
-------------------
1. Running cluster jobs as the cluster user: can we have users authenticate with
    QIIME using their monsoon account credentials, and may the QIIME server process
    spawn subprocesses as the authenticated user?
2. Is it acceptable to have QIIME running as a system-level service/daemon?
3. What would be the easiest way for you as a sysadmin to configure QIIME's database?
4. How would you like users to install QIIME plugins?
